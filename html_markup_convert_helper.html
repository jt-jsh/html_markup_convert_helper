<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>html markup convert helper</title>

    <style>
        #convert_html>div {
            overflow: hidden;
            width: 0;
            height: 0;
            opacity: 0;
            position: absolute;
            left: -9999px;
        }
    </style>

    <script>
        var attrs = [
            'class',
            'id',

            'style',
            'width',
            'height',

            'border',
            'bordercolor',
            'cellpadding',
            'cellspacing',
            'rules',

            'font',
            'align',
            'color',
        ]

        function HandleConvertHtml() {
            var textarea = document.querySelector('#convert_html > textarea');
            var convert = document.querySelector('#convert_html > div');
            var result = document.querySelector('#result_html');

            // reset
            convert.innerHTML = textarea.value;

            function init() {
                // variables
                var elements = [];

                var link = convert.getElementsByTagName('link')[0];
                if (link) link.remove();

                var content = convert.getElementsByTagName('table')[0];
                var map = convert.getElementsByTagName('map')[0];

                var tables = content.getElementsByTagName('table');
                var ths = content.getElementsByTagName('th');
                var tds = content.getElementsByTagName('td');
                var paragraphs = content.getElementsByTagName('p');
                var spans = content.getElementsByTagName('span');
                var strongs = content.getElementsByTagName('strong');
                var anchors = content.getElementsByTagName('a');
                var h1s = content.getElementsByTagName('h1');
                var h2s = content.getElementsByTagName('h2');
                var h3s = content.getElementsByTagName('h3');

                // extract pattern
                var ext_span_pattern = /<(\/span|span)([^>]*)>/gi;
                var ext_span_replace = '';
                var ext_strong_pattern = /<(\/strong|strong)([^>]*)>/gi;
                var ext_strong_replace = '';
                var ext_h1_pattern = /h1>/gi;
                var ext_h1_replace = 'h2>';

                // function
                function handlePushElements(nodes) {
                    Array.prototype.forEach.call(nodes, function (node) {
                        elements.push(node);
                    });
                }

                function handleTitleTrim(titles) {
                    Array.prototype.forEach.call(titles, function (title) {
                        title.innerHTML = title.innerHTML.trim();
                    });
                }

                function handleExtPattern(html, pattern, replace) {
                    return html.replace(pattern, replace);
                }

                // init 
                handlePushElements(tables);
                handlePushElements(ths);
                handlePushElements(tds);
                handlePushElements(paragraphs);
                handlePushElements(spans);
                handlePushElements(strongs);
                handlePushElements(anchors);
                handlePushElements(h1s);
                handlePushElements(h2s);
                handlePushElements(h3s);

                // tag inline trim
                handleTitleTrim(paragraphs);
                handleTitleTrim(h1s);
                handleTitleTrim(h2s);
                handleTitleTrim(h3s);

                // delete attribute
                Array.prototype.forEach.call(elements, function (element) {
                    Array.prototype.forEach.call(attrs, function (attr) {

                        element.removeAttribute(attr);

                        // delete title tag (h1, h2, h3) inline strong tag
                        if (
                            element.tagName == 'H1'
                            || element.tagName == 'H2'
                            || element.tagName == 'H3'
                        ) {
                            element.innerHTML = handleExtPattern(element.innerHTML, ext_strong_pattern, ext_strong_replace);
                        }
                    });
                });

                // delete table caption tag
                Array.prototype.forEach.call(tables, function (table) {
                    var captions = table.getElementsByTagName('caption');
                    if (captions.length > 0) {
                        Array.prototype.forEach.call(captions, function (caption) {
                            caption.remove();
                        });
                    }
                });

                // line clean up
                var lines = convert.querySelectorAll('#convert_html > div > table > tbody > tr > td');
                var filterLines = [];
                var html = '';

                Array.prototype.forEach.call(lines, function (line) {
                    line.innerHTML = line.innerHTML.trim();

                    if (line.innerHTML != '&nbsp;' && line.innerHTML != '<p>&nbsp;</p>') {
                        if (line.innerHTML.indexOf('<') != 0) {
                            line.innerHTML = '<p>' + line.innerHTML + '</p>';
                        }

                        filterLines.push(line);
                    }
                });

                Array.prototype.forEach.call(filterLines, function (line) {
                    html += line.innerHTML + '\n';
                });

                html = handleExtPattern(html, ext_span_pattern, ext_span_replace);
                html = handleExtPattern(html, ext_h1_pattern, ext_h1_replace);

                result.innerHTML = html;

                if(map){
                    result.appendChild(map);
                }
                
            }
            
            init();

        }
    </script>
</head>

<body>

    <div id="convert_html">
        <textarea>
            
        </textarea>
        <div>

        </div>
    </div>

    <div>
        <button onclick="HandleConvertHtml();">Start Convert</button>
    </div>

    <div id="result_html"></div>
</body>

</html>